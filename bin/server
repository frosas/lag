#!/bin/bash

set -ex

source $(dirname $0)/common

trap "exit" SIGINT
trap "kill 0" EXIT

web_server="forever src/server/http.js"
    
if [[ $is_dev ]]; then
  webpack --watch &
  nodemon --watch "src" --watch "test" --exec "eslint . --fix" &
  nodemon --watch "src" --watch "test" --exec "mocha 'test/**/*.js'" &
  nodemon --watch "src/server" --watch "src/universal" --exec "$web_server" &
else
  $web_server &
fi

wait