#!/bin/bash

set -ex

source $(dirname $0)/common

on_sigint() { kill 0; }
trap on_sigint SIGINT
    
if [[ $is_dev ]]; then
    webpack --watch &
    nodemon --watch src --exec 'eslint .' &
    mocha -w &
fi

forever \
    --minUptime 1000 \
    --spinSleepTime 1000 \
    $([[ $is_dev ]] && echo '--watch --watchDirectory src') \
    src/server/http.js &

wait